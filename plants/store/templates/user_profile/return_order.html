{% extends 'user_profile/base_sidebar.html' %}
{% load static %}
{% block content %}

<div class="container mt-5" style="max-width: 750px;">
    <div class="card shadow-sm p-4">
        <h2 class="text-center mb-4">Return Order #{{ order.order_id }}</h2>

        <!-- Products List -->
        <p><strong>Product(s):</strong></p>
        <ul class="list-group mb-3">
            {% for item in order.items.all %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {{ item.product.name }}
                    <span class="badge bg-primary rounded-pill">Qty: {{ item.quantity }}</span>
                </li>
            {% endfor %}
        </ul>

        <!-- Order Status -->
        <p><strong>Status:</strong> {{ order.status }}</p>

        {% if order.status == "DELIVERED" %}
        <form method="POST" id="returnForm">
            {% csrf_token %}

            <div class="mb-4">
                <label for="reason" class="form-label fw-bold">
                    Reason for Return <span class="text-danger">*</span>
                </label>

                <textarea 
                    name="reason" 
                    id="reason" 
                    class="form-control reason-textarea" 
                    required
                    placeholder="Please tell us why you're returning this order (minimum 5 characters)"
                    minlength="5"
                ></textarea>

                <small class="text-muted">Your feedback helps us improve our product and service.</small>

                <div class="invalid-feedback" id="reasonError">
                    Please provide a reason (minimum 5 characters)
                </div>
            </div>

            <button type="submit" class="btn btn-warning w-100">Submit Return Request</button>
            <a href="{% url 'orders:orders_list' %}" class="btn btn-secondary w-100 mt-2">Cancel</a>
        </form>
        {% else %}
        <div class="alert alert-info text-center mt-3">
            Return can only be requested for delivered orders.
        </div>
        {% endif %}

    </div>
</div>

<!-- Toast Notification -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="returnToast" class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body">
                Return request submitted successfully!
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
</div>

<!-- Bootstrap CSS & JS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- JS Validation + Toast -->
<script>
document.getElementById('returnForm')?.addEventListener('submit', function(e) {
    e.preventDefault();

    const reasonInput = document.getElementById('reason');
    const reason = reasonInput.value.trim();
    const reasonError = document.getElementById('reasonError');

    if (!reason) {
        reasonError.textContent = "Please enter a reason for return.";
        reasonInput.classList.add('is-invalid');
        return;
    } else {
        reasonError.textContent = "";
        reasonInput.classList.remove('is-invalid');
    }

    // Submit the form normally
    this.submit();
});
</script>

<style>
    body {
        background-color: #f8f9fa;
        font-family: 'Segoe UI', sans-serif;
    }
    .card {
        border-radius: 12px;
    }
    .btn-warning {
        background: linear-gradient(135deg, #ffc107 30%, #e0a800 100%);
        border: none;
        font-weight: 600;
    }
    .btn-warning:hover {
        background: linear-gradient(135deg, #e0a800 30%, #ffc107 100%);
    }
</style>

{% endblock %}
