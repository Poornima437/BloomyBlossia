{% extends 'custom_admin/customadmin_base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4>Order #{{ order.order_id }}</h4>
    <div>
      <a href="{% url 'export_invoice' order.order_id %}" class="btn btn-outline-secondary btn-sm">Export</a>
      <a href="{% url 'generate_invoice' order.order_id %}" class="btn btn-outline-primary btn-sm">Invoice</a>
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-body row">
      <div class="col-md-6">
        <h6>Status: <span class="badge badge-{{ order.status|lower }}">{{ order.status }}</span></h6>
        <p><strong>Date:</strong> {{ order.created_at|date:"Y-m-d H:i" }}</p>
        <p><strong>Payment Method:</strong> {{ order.payment_method }}</p>
      </div>
      <div class="col-md-6">
        <h6>Customer Info</h6>
        <p><strong>Name:</strong> {{ order.user.get_full_name }}</p>
        <p><strong>Email:</strong> {{ order.user.email }}</p>
      </div>
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-body">
      <h6>Order List</h6>
      <table class="table">
        <thead>
          <tr>
            <th>Product</th>
            <th>Qty</th>
            <th>Price</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          {% for item in order.items.all %}
          <tr>
            <td>{{ item.product.name }}</td>
            <td>{{ item.quantity }}</td>
            <td>&#8377;{{ item.price }}</td>
            <td>&#8377;{{ item.total_price }}</td>

          </tr>
          {% endfor %}
          <tr><td colspan="3" class="text-right">Total Amount</td><td>&#8377;{{ order.total }}</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <h6>Shipping Address</h6>
      <p>{{ order.address }}</p>
    </div>
  </div>

  <form method="post" action="{% url 'update_order_status' order.order_id %}" class="mt-4">
    {% csrf_token %}
    <label for="status">Update Status:</label>
    <select name="status" class="form-control w-25 d-inline">
      {% for value, display in order.STATUS_CHOICES %}
        <option value="{{ value }}" {% if order.status == value %}selected{% endif %}>{{ display }}</option>
      {% endfor %}
    </select>
    <button type="submit" class="btn btn-success ml-2">Update</button>
  </form>

  {% if order.return_request == 'Pending' %}
    <a href="{% url 'verify_return' order.order_id %}" class="btn btn-danger mt-3">Verify Return</a>
  {% endif %}
</div>

{% endblock %}


